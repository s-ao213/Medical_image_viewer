# DICOM画像ビューア 操作マニュアル

コンピューター上のDICOM画像ファイルを表示・操作するためのビューアです。予備知識がない方でも使えるように、詳しく説明します。

## 📖 目次

1. [このアプリケーションについて](#このアプリケーションについて)
2. [環境構築（初回のみ）](#環境構築初回のみ)
3. [使い方：5つのステップ](#使い方5つのステップ)
4. [画面の見方](#画面の見方)
5. [スライダーの使い方](#スライダーの使い方)
6. [よくある質問](#よくある質問)

## このアプリケーションについて

コンピューターにダウンロード済みのDICOM（医療用画像）ファイルを開いて、様々な角度から観察できるビューアです。

**主な機能**
- ✅ 単一または複数のDICOMファイルを読み込み
- ✅ フォルダ内の全DICOMファイルを一括読み込み
DICOM画像ビューア — 簡潔マニュアル

目的: ローカルのDICOMファイル（.dcm）を読み込み、Axial（横断）とSagittal/Coronal（縦断）を同時に表示し、右側に画像/患者情報を表示、画面下部に大きな画像調整パネル（スライダー横並び）を配置します。起動時にフォルダ選択ダイアログが自動表示されます。

必須環境: Python 3.7+、pipで以下をインストールしてください: pydicom numpy matplotlib pillow

インストール: PowerShellで一度だけ実行

pip install pydicom numpy matplotlib pillow

起動: dicom_viewer.pyを実行

python dicom_viewer.py

起動時の挙動: フォルダ選択ダイアログが開き、選択したフォルダ内の.dcmをすべて読み込みます（単一ファイル/複数ファイルもツールバーから選択可）。

画面構成（簡潔）: 画面上部に画像（左: Axial、右: Sagittal/Coronal）、右端にスクロール可能な情報パネル（画像サイズ・枚数・厚さ・患者名・患者ID・性別・生年月日・年齢・検査日・検査部位・モダリティ・機器）、画面下部に大きな画像調整パネル（スライダー横並び、長さ調整済み）があります。

主要操作:
- ファイル→DICOMファイルを開く: 単一ファイル
- ファイル→複数のDICOMファイルを開く: 複数選択
- ファイル→DICOMフォルダを開く: フォルダ選択
- 表示モード切替: Sagittal / Coronal
- スライダー: Axialスライス、右断面スライス、Window Width、Window Level

画面ヒント:
- 交差線: Axial上に表示（Sagittal時はシアン縦線、Coronal時は黄色横線）
- Window Width: コントラスト、Window Level: 明るさ中心

トラブルシューティング（要点）:
- 依存がない: pip installで不足ライブラリを追加
- 画像が真っ黒／白: Window Levelを調整、次にWidthを調整
- ファイルが開けない: .dcmか、ファイルパスに日本語・特殊文字が含まれていないか確認

注意: 患者情報はDICOMヘッダから取得します。取り扱いに注意してください。

作成日: 2025-10-22
**推奨値**
- 初期値: 400
- 全体を見る: 800-2000
- 細部を見る: 200-400

**使用例**
- 画像がぼんやりしている → 値を小さくする（例: 400 → 200）
- 画像の明暗差が激しすぎる → 値を大きくする（例: 400 → 800）

### 5. Window Level（重要）

**何をするもの** 画像の**明るさの中心値**を調整

**動かすとどうなる**
- **右に動かす（値を大きく）** → 画像が暗くなる
- **左に動かす（値を小さく）** → 画像が明るくなる

**推奨値**
- 初期値: 40
- 調整範囲: -1000 〜 1000

**使用例**
- 画像が暗い・真っ黒 → 値を小さくする（例: 40 → -100）
- 画像が明るい・真っ白 → 値を大きくする（例: 40 → 200）

### Window Width と Window Level の組み合わせ方

**基本の調整手順**
1. まず **Window Level** で明るさを調整（画像が見えるようにする）
2. 次に **Window Width** でコントラストを調整（見やすくする）
3. 両方を微調整して最適な表示を探す

**組み合わせ例**

| 目的 | Window Width | Window Level | 効果 |
|------|--------------|--------------|------|
| 標準表示 | 400 | 40 | バランスの取れた表示 |
| 明るくする | 400 | -100 | 暗い部分が見える |
| 暗くする | 400 | 200 | 明るい部分が見える |
| はっきりさせる | 200 | 40 | コントラスト強 |
| 全体を見る | 1000 | 0 | 広範囲が見える |

## よくある質問

### Q1: アプリが起動しません

**確認事項**
1. Pythonがインストールされているか
   ```powershell
   python --version
   ```
2. 必要なライブラリがインストールされているか
   ```powershell
   pip install pydicom numpy matplotlib pillow
   ```
3. 正しいフォルダにいるか（dicom_viewer.pyがある場所）

### Q2: 画像が真っ黒です

**原因** Window Levelが高すぎる

**解決方法**
1. **Window Level スライダーを左に動かす**（値を小さく）
2. 少しずつ動かして、画像が見えるまで調整
3. それでもダメなら、Window Widthを大きく（1000程度）してから再調整

### Q3: 画像が真っ白です

**原因** Window Levelが低すぎる

**解決方法**
1. **Window Level スライダーを右に動かす**（値を大きく）
2. 少しずつ動かして、画像が見えるまで調整

### Q4: ファイルが開けません

**考えられる原因**
1. **DICOMファイルでない** - 拡張子が.dcmでも、中身がDICOMでない場合があります。別のDICOMファイルで試してください
2. **ファイルパスに問題がある** - 日本語が含まれていないか確認。ファイルが存在するか確認
3. **ライブラリのインストール不足**
   ```powershell
   pip install pydicom numpy matplotlib pillow
   ```

### Q5: 複数ファイルを読み込んだが、スライス数が合いません

**原因** 一部のファイルが読み込めなかった可能性

**確認方法**
- 読み込み成功ダイアログに表示される情報を確認
- フォルダ内に.dcmファイルのみがあるか確認

### Q6: 交差線が見えません

**原因** 交差線の色と画像が同化している

**解決方法**
- Window Width/Levelを調整
- 表示モードを切り替えてみる（Sagittal ↔ Coronal）

### Q7: スライダーが動きません

**原因** ファイルが正しく読み込まれていない

**解決方法**
1. ファイルを開き直す
2. 別のDICOMファイルで試す

### Q8: "ModuleNotFoundError" というエラーが出ます

**原因** 必要なライブラリがインストールされていない

**解決方法**
```powershell
pip install pydicom numpy matplotlib pillow
```

## 用語集

### DICOM（ダイコム）
医療用画像の標準フォーマット。CT、MRI、X線などの画像に使用される。

### スライス
3D画像の1枚1枚の断面。例: 50スライス = 50枚の断面画像

### Axial（アキシャル）
横断面。体を水平に輪切りにした画像。上から見た図。

### Sagittal（サジタル）
矢状断面。体を左右に分ける縦の断面。横から見た図。

### Coronal（コロナル）
冠状断面。体を前後に分ける縦の断面。正面から見た図。

### Window Width（ウィンドウ幅）
表示するコントラストの幅。大きい=ぼんやり、小さい=はっきり

### Window Level（ウィンドウレベル）
表示する明るさの中心値。高い=暗い、低い=明るい

### 交差線
Axial画像上に表示される線。他の断面の位置を示す。

## ファイル構成

```
test/
├── dicom_viewer.py           # このプログラムを実行
├── README.md                 # このマニュアル
└── （あなたのDICOMファイル）  # .dcmファイルをここに配置
```

## トラブル時のチェックリスト

アプリが正常に動作しない場合、以下を順番に確認してください:

- [ ] Pythonがインストールされている（`python --version`）
- [ ] ライブラリがインストールされている（`pip list`で確認）
- [ ] DICOMファイルが正しい形式である
- [ ] ファイルパスに日本語や特殊文字が含まれていない
- [ ] dicom_viewer.pyと同じフォルダで実行している

**作成日**: 2025年10月22日  
