# DICOM画像ビューア 操作マニュアル

コンピューター上のDICOM画像ファイルを表示・操作するためのビューアです。予備知識がない方でも使えるように、詳しく説明します。

## 📖 目次

1. [このアプリケーションについて](#このアプリケーションについて)
2. [環境構築（初回のみ）](#環境構築初回のみ)
3. [使い方：5つのステップ](#使い方5つのステップ)
4. [画面の見方](#画面の見方)
5. [スライダーの使い方](#スライダーの使い方)
6. [よくある質問](#よくある質問)

## このアプリケーションについて

### 何ができるの？

コンピューターにダウンロード済みのDICOM（医療用画像）ファイルを開いて、様々な角度から観察できるビューアです。

**主な機能:**
- ✅ 単一または複数のDICOMファイルを読み込み
- ✅ フォルダ内の全DICOMファイルを一括読み込み
- ✅ 3つの断面（Axial/Sagittal/Coronal）で表示
- ✅ 明るさ・コントラストを自由に調整
- ✅ スライス（断面）を切り替えて観察

### 特徴

- **特殊な環境不要**: Pythonと標準的なライブラリのみ
- **簡単インストール**: コマンド1つで準備完了
- **直感的な操作**: スライダーを動かすだけ

## 環境構築（初回のみ）

### ステップ1: Pythonの確認

PowerShellを開いて以下を実行:

```powershell
python --version
```

`Python 3.7.0` 以上が表示されればOK。表示されない場合は[Python公式サイト](https://www.python.org/downloads/)からインストールしてください。

### ステップ2: 必要なライブラリをインストール

PowerShellで以下のコマンドを1回だけ実行:

```powershell
pip install pydicom numpy matplotlib pillow
```

これで準備完了です！

## 使い方：5つのステップ

### ステップ1: アプリを起動

PowerShellで以下を実行:

```powershell
python dicom_viewer.py
```

ウィンドウが開き、ファイル選択ダイアログが自動的に表示されます。

### ステップ2: DICOMファイルを開く

**3つの方法から選べます:**

#### 方法A: 1つのファイルを開く
- ツールバーの **「📁 ファイルを開く」** をクリック
- コンピューター上のDICOMファイル（.dcm）を選択
- 「開く」をクリック

#### 方法B: 複数のファイルを同時に開く
- ツールバーの **「📂 複数ファイルを開く」** をクリック
- **Ctrlキーを押しながら**複数のファイルを選択
- 「開く」をクリック

#### 方法C: フォルダごと開く（推奨）
- ツールバーの **「📁 フォルダを開く」** をクリック
- DICOMファイルが保存されているフォルダを選択
- フォルダ内の全.dcmファイルが自動的に読み込まれます

**キーボードショートカット:**
- **Ctrl + O**: 単一ファイルを開く
- **Ctrl + Shift + O**: 複数ファイルを開く
- **Ctrl + D**: フォルダを開く

### ステップ3: 画像を確認

画像が2枚表示されます:
- **左側**: Axial画像（横断面 - 輪切り）
- **右側**: Sagittal または Coronal画像（縦断面）

### ステップ4: スライダーで調整

画面下部のスライダーを動かして、見やすいように調整します。

### ステップ5: 表示モードを切り替え

「表示モード」ドロップダウンで **Sagittal（横から）** または **Coronal（正面から）** を選択できます。

## 画面の見方

```
┌─────────────────────────────────────────────────┐
│ [📁ファイルを開く] [📂複数] [📁フォルダ]        │ ← ツールバー
│ ファイル: ○○.dcm                               │
├─────────────────────────────────────────────────┤
│                                                 │
│  左側: Axial画像        右側: Sagittal/Coronal  │
│  （横断面・輪切り）     （縦断面）               │
│                                                 │
│  交差線が表示 →        ← 縦断面の位置を表示     │
│                                                 │
├─────────────────────────────────────────────────┤
│ 【画像調整】                                     │
│ Axial スライス:    [スライダー] 25 / 49        │
│ 表示モード:        [Sagittal ▼]                │
│ スライス:          [スライダー] 128 / 255      │
│ Window Width:      [スライダー] 400            │
│ Window Level:      [スライダー] 40             │
└─────────────────────────────────────────────────┘
```

### 左側の画像（Axial - 横断面）

体を水平に輪切りにした画像。上から見た図。

**交差線について:**
- **シアン色の縦線**: Sagittal表示時（右側の画像がどこを切っているか）
- **黄色の横線**: Coronal表示時

### 右側の画像（Sagittal / Coronal）

**Sagittal（サジタル）**: 体を左右に分ける縦の断面（横から見た図）  
**Coronal（コロナル）**: 体を前後に分ける縦の断面（正面から見た図）

## スライダーの使い方

画面下部に5つのコントロールがあります。それぞれの機能を説明します。

### 1. Axial スライス

**何をするもの:** 左側の画像（横断面）のスライス番号を変更

**動かすとどうなる:**
- **右に動かす** → より下の部分の断面を表示
- **左に動かす** → より上の部分の断面を表示

**表示:** 「25 / 49」= 現在25番目 / 全49スライス

### 2. 表示モード

**何をするもの:** 右側の画像の向きを変更

**選択肢:**
- **Sagittal**: 横から見た画像（縦線が左側に表示）
- **Coronal**: 正面から見た画像（横線が左側に表示）

### 3. スライス（2つ目）

**何をするもの:** 右側の画像のスライス位置を変更

**動かすとどうなる:**
- スライダーを動かすと、左側の交差線が移動
- 右側の画像が変わる

### 4. Window Width（重要）

**何をするもの:** 画像の**コントラスト**（明暗の差）を調整

**動かすとどうなる:**
- **右に動かす（値を大きく）** → コントラスト弱い（全体が見える、ぼんやり）
- **左に動かす（値を小さく）** → コントラスト強い（特定部分がはっきり）

**推奨値:**
- 初期値: 400
- 全体を見る: 800-2000
- 細部を見る: 200-400

**使用例:**
- 画像がぼんやりしている → 値を小さくする（例: 400 → 200）
- 画像の明暗差が激しすぎる → 値を大きくする（例: 400 → 800）

### 5. Window Level（重要）

**何をするもの:** 画像の**明るさの中心値**を調整

**動かすとどうなる:**
- **右に動かす（値を大きく）** → 画像が暗くなる
- **左に動かす（値を小さく）** → 画像が明るくなる

**推奨値:**
- 初期値: 40
- 調整範囲: -1000 〜 1000

**使用例:**
- 画像が暗い・真っ黒 → 値を小さくする（例: 40 → -100）
- 画像が明るい・真っ白 → 値を大きくする（例: 40 → 200）

### Window Width と Window Level の組み合わせ方

**基本の調整手順:**
1. まず **Window Level** で明るさを調整（画像が見えるようにする）
2. 次に **Window Width** でコントラストを調整（見やすくする）
3. 両方を微調整して最適な表示を探す

**組み合わせ例:**

| 目的 | Window Width | Window Level | 効果 |
|------|--------------|--------------|------|
| 標準表示 | 400 | 40 | バランスの取れた表示 |
| 明るくする | 400 | -100 | 暗い部分が見える |
| 暗くする | 400 | 200 | 明るい部分が見える |
| はっきりさせる | 200 | 40 | コントラスト強 |
| 全体を見る | 1000 | 0 | 広範囲が見える |

## よくある質問

### Q1: アプリが起動しません

**確認事項:**
1. Pythonがインストールされているか
   ```powershell
   python --version
   ```
2. 必要なライブラリがインストールされているか
   ```powershell
   pip install pydicom numpy matplotlib pillow
   ```
3. 正しいフォルダにいるか（dicom_viewer.pyがある場所）

### Q2: 画像が真っ黒です

**原因:** Window Levelが高すぎる

**解決方法:**
1. **Window Level スライダーを左に動かす**（値を小さく）
2. 少しずつ動かして、画像が見えるまで調整
3. それでもダメなら、Window Widthを大きく（1000程度）してから再調整

### Q3: 画像が真っ白です

**原因:** Window Levelが低すぎる

**解決方法:**
1. **Window Level スライダーを右に動かす**（値を大きく）
2. 少しずつ動かして、画像が見えるまで調整

### Q4: ファイルが開けません

**考えられる原因:**
1. **DICOMファイルでない** - 拡張子が.dcmでも、中身がDICOMでない場合があります。別のDICOMファイルで試してください
2. **ファイルパスに問題がある** - 日本語が含まれていないか確認。ファイルが存在するか確認
3. **ライブラリのインストール不足**
   ```powershell
   pip install pydicom numpy matplotlib pillow
   ```

### Q5: 複数ファイルを読み込んだが、スライス数が合いません

**原因:** 一部のファイルが読み込めなかった可能性

**確認方法:**
- 読み込み成功ダイアログに表示される情報を確認
- フォルダ内に.dcmファイルのみがあるか確認

### Q6: 交差線が見えません

**原因:** 交差線の色と画像が同化している

**解決方法:**
- Window Width/Levelを調整
- 表示モードを切り替えてみる（Sagittal ↔ Coronal）

### Q7: スライダーが動きません

**原因:** ファイルが正しく読み込まれていない

**解決方法:**
1. ファイルを開き直す
2. 別のDICOMファイルで試す

### Q8: "ModuleNotFoundError" というエラーが出ます

**原因:** 必要なライブラリがインストールされていない

**解決方法:**
```powershell
pip install pydicom numpy matplotlib pillow
```

## 用語集

### DICOM（ダイコム）
医療用画像の標準フォーマット。CT、MRI、X線などの画像に使用される。

### スライス
3D画像の1枚1枚の断面。例: 50スライス = 50枚の断面画像

### Axial（アキシャル）
横断面。体を水平に輪切りにした画像。上から見た図。

### Sagittal（サジタル）
矢状断面。体を左右に分ける縦の断面。横から見た図。

### Coronal（コロナル）
冠状断面。体を前後に分ける縦の断面。正面から見た図。

### Window Width（ウィンドウ幅）
表示するコントラストの幅。大きい=ぼんやり、小さい=はっきり

### Window Level（ウィンドウレベル）
表示する明るさの中心値。高い=暗い、低い=明るい

### 交差線
Axial画像上に表示される線。他の断面の位置を示す。

## ファイル構成

```
test/
├── dicom_viewer.py           # このプログラムを実行
├── README.md                 # このマニュアル
└── （あなたのDICOMファイル）  # .dcmファイルをここに配置
```

## トラブル時のチェックリスト

アプリが正常に動作しない場合、以下を順番に確認してください:

- [ ] Pythonがインストールされている（`python --version`）
- [ ] ライブラリがインストールされている（`pip list`で確認）
- [ ] DICOMファイルが正しい形式である
- [ ] ファイルパスに日本語や特殊文字が含まれていない
- [ ] dicom_viewer.pyと同じフォルダで実行している

**作成日**: 2025年10月22日  
**対象**: 高専4年生 知能情報実験実習2 後期課題
